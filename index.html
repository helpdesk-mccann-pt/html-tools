<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NUVEM_CRIATIVA URL Updater</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 50px; }
        input { width: 80%; padding: 10px; margin: 10px; }
        button { padding: 10px 20px; cursor: pointer; }
    </style>
</head>
<body>
    <h2>NUVEM_CRIATIVA URL Updater</h2>
    <input type="text" id="oldUrl" placeholder="Enter old URL here">
    <button onclick="updateUrl()">Update URL</button>
    <p id="newUrl"></p>
    <button id="copyButton" style="display: none;" onclick="copyUrl()">Copy URL</button>
    <button id="openButton" style="display: none;" onclick="openUrl()">Open URL</button>

    <script>
        function updateUrl() {
            let oldUrl = document.getElementById("oldUrl").value;
            let newUrl = oldUrl;
            
            // Extract query string from the URL
            let urlObj = new URL(oldUrl);
            let queryParams = new URLSearchParams(urlObj.search);
            let pathParam = queryParams.get("id");

            if (pathParam) {
                // Decode it only once
                let decodedPath = decodeURIComponent(pathParam);

                // Replace 'NEW' or 'DROPBOX' with '2024' in the correct location
                let updatedPath = decodedPath.replace(/(NUVEM_CRIATIVA)\/(NEW|DROPBOX)/, "$1/2024");

                // Update the query parameter without double encoding
                queryParams.set("id", updatedPath);

                // Rebuild the full URL
                newUrl = urlObj.origin + urlObj.pathname + "?" + queryParams.toString();
            }

            // Update the displayed URL
            document.getElementById("newUrl").innerText = newUrl;
            document.getElementById("copyButton").style.display = "inline-block";
            document.getElementById("openButton").style.display = "inline-block";
        }

        function copyUrl() {
            let text = document.getElementById("newUrl").innerText;

            if (navigator.clipboard && navigator.clipboard.writeText) {
                // Modern clipboard API (Chrome, Edge, Firefox)
                navigator.clipboard.writeText(text)
                    .then(() => alert("URL copied to clipboard!"))
                    .catch(err => {
                        console.error("Clipboard copy failed", err);
                        fallbackCopyText(text);
                    });
            } else {
                // Fallback for older browsers
                fallbackCopyText(text);
            }
        }

        // Fallback method using a temporary text area
        function fallbackCopyText(text) {
            let textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand("copy");
            document.body.removeChild(textArea);
            alert("URL copied to clipboard!");
        }

        function openUrl() {
            let url = document.getElementById("newUrl").innerText;
            window.open(url, "_blank");
        }
    </script>
</body>
</html>
